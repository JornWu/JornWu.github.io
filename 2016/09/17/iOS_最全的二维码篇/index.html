<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/blog/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/blog/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/blog/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/blog/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="äºŒç»´ç æ‰«é¢å½“ä¸‹å¾ˆæµè¡Œï¼Œä¹Ÿå¸¦æ¥äº†å¾ˆå¤šçš„ä¾¿åˆ©ã€‚æˆ‘ä¹Ÿä¸æ˜¯åœ¨å¹æ§ï¼Œä½ ä¹Ÿè®¸ä½ ä¹Ÿå‘ç°ï¼Œå‡ ä¹å‡¡æ˜¯ä¸ªAPPï¼Œéƒ½æœ‰æ‰«æäºŒç»´ç çš„åŠŸèƒ½ã€‚ç°åœ¨ç½‘ä¸Šçš„èµ„æ–™å¾ˆå¤šï¼Œæˆ‘ä¹Ÿæ˜¯é—²çš„è›‹ç–¼ï¼Œåœ¨åšä¸€ä¸ªç¾å›¢çš„é«˜ä»¿é¡¹ç›®ï¼Œæ¶‰åŠåˆ°äºŒç»´ç çš„æ‰«æåŠŸèƒ½ï¼ŒiOS7ä¹‹å‰ï¼Œå¼€å‘è€…è¿›è¡Œæ‰«ç ç¼–ç¨‹æ—¶ï¼Œä¸€èˆ¬ä¼šå€ŸåŠ©ç¬¬ä¸‰æ–¹åº“ã€‚å¸¸ç”¨çš„æ˜¯ZBarSDKaå’ŒZXingObjCï¼ŒiOS7ä¹‹åï¼Œç³»ç»Ÿçš„AVMetadataObjectç±»ä¸­ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†è§£æäºŒç»´ç çš„æ¥å£ã€‚ç»è¿‡æµ‹è¯•ï¼Œä½¿">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS_æœ€å…¨çš„äºŒç»´ç ç¯‡">
<meta property="og:url" content="https://JornWu.github.io/blog/2016/09/17/iOS_æœ€å…¨çš„äºŒç»´ç ç¯‡/index.html">
<meta property="og:site_name" content="Jorn&#39;s Blog">
<meta property="og:description" content="äºŒç»´ç æ‰«é¢å½“ä¸‹å¾ˆæµè¡Œï¼Œä¹Ÿå¸¦æ¥äº†å¾ˆå¤šçš„ä¾¿åˆ©ã€‚æˆ‘ä¹Ÿä¸æ˜¯åœ¨å¹æ§ï¼Œä½ ä¹Ÿè®¸ä½ ä¹Ÿå‘ç°ï¼Œå‡ ä¹å‡¡æ˜¯ä¸ªAPPï¼Œéƒ½æœ‰æ‰«æäºŒç»´ç çš„åŠŸèƒ½ã€‚ç°åœ¨ç½‘ä¸Šçš„èµ„æ–™å¾ˆå¤šï¼Œæˆ‘ä¹Ÿæ˜¯é—²çš„è›‹ç–¼ï¼Œåœ¨åšä¸€ä¸ªç¾å›¢çš„é«˜ä»¿é¡¹ç›®ï¼Œæ¶‰åŠåˆ°äºŒç»´ç çš„æ‰«æåŠŸèƒ½ï¼ŒiOS7ä¹‹å‰ï¼Œå¼€å‘è€…è¿›è¡Œæ‰«ç ç¼–ç¨‹æ—¶ï¼Œä¸€èˆ¬ä¼šå€ŸåŠ©ç¬¬ä¸‰æ–¹åº“ã€‚å¸¸ç”¨çš„æ˜¯ZBarSDKaå’ŒZXingObjCï¼ŒiOS7ä¹‹åï¼Œç³»ç»Ÿçš„AVMetadataObjectç±»ä¸­ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†è§£æäºŒç»´ç çš„æ¥å£ã€‚ç»è¿‡æµ‹è¯•ï¼Œä½¿">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-03-05T15:00:24.755Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS_æœ€å…¨çš„äºŒç»´ç ç¯‡">
<meta name="twitter:description" content="äºŒç»´ç æ‰«é¢å½“ä¸‹å¾ˆæµè¡Œï¼Œä¹Ÿå¸¦æ¥äº†å¾ˆå¤šçš„ä¾¿åˆ©ã€‚æˆ‘ä¹Ÿä¸æ˜¯åœ¨å¹æ§ï¼Œä½ ä¹Ÿè®¸ä½ ä¹Ÿå‘ç°ï¼Œå‡ ä¹å‡¡æ˜¯ä¸ªAPPï¼Œéƒ½æœ‰æ‰«æäºŒç»´ç çš„åŠŸèƒ½ã€‚ç°åœ¨ç½‘ä¸Šçš„èµ„æ–™å¾ˆå¤šï¼Œæˆ‘ä¹Ÿæ˜¯é—²çš„è›‹ç–¼ï¼Œåœ¨åšä¸€ä¸ªç¾å›¢çš„é«˜ä»¿é¡¹ç›®ï¼Œæ¶‰åŠåˆ°äºŒç»´ç çš„æ‰«æåŠŸèƒ½ï¼ŒiOS7ä¹‹å‰ï¼Œå¼€å‘è€…è¿›è¡Œæ‰«ç ç¼–ç¨‹æ—¶ï¼Œä¸€èˆ¬ä¼šå€ŸåŠ©ç¬¬ä¸‰æ–¹åº“ã€‚å¸¸ç”¨çš„æ˜¯ZBarSDKaå’ŒZXingObjCï¼ŒiOS7ä¹‹åï¼Œç³»ç»Ÿçš„AVMetadataObjectç±»ä¸­ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†è§£æäºŒç»´ç çš„æ¥å£ã€‚ç»è¿‡æµ‹è¯•ï¼Œä½¿">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/blog/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://JornWu.github.io/blog/2016/09/17/iOS_æœ€å…¨çš„äºŒç»´ç ç¯‡/">





  <title>iOS_æœ€å…¨çš„äºŒç»´ç ç¯‡ | Jorn's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/blog/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jorn's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/blog/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/blog/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            å…³äº
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/blog/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/blog/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/blog/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            å½’æ¡£
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://JornWu.github.io/blog/blog/2016/09/17/iOS_æœ€å…¨çš„äºŒç»´ç ç¯‡/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jorn Wu">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/blog/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jorn's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">iOS_æœ€å…¨çš„äºŒç»´ç ç¯‡</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-09-17T19:09:38+08:00">
                2016-09-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o">æœ¬æ–‡æ€»é˜…è¯»é‡</i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>æ¬¡
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡&#58;</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  2.9k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  13
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>äºŒç»´ç æ‰«é¢å½“ä¸‹å¾ˆæµè¡Œï¼Œä¹Ÿå¸¦æ¥äº†å¾ˆå¤šçš„ä¾¿åˆ©ã€‚æˆ‘ä¹Ÿä¸æ˜¯åœ¨å¹æ§ï¼Œä½ ä¹Ÿè®¸ä½ ä¹Ÿå‘ç°ï¼Œå‡ ä¹å‡¡æ˜¯ä¸ªAPPï¼Œéƒ½æœ‰æ‰«æäºŒç»´ç çš„åŠŸèƒ½ã€‚ç°åœ¨ç½‘ä¸Šçš„èµ„æ–™å¾ˆå¤šï¼Œæˆ‘ä¹Ÿæ˜¯é—²çš„è›‹ç–¼ï¼Œåœ¨åšä¸€ä¸ª<a href="https://github.com/JornWu/MeiTuan_Swift" target="_blank" rel="noopener">ç¾å›¢çš„é«˜ä»¿é¡¹ç›®</a>ï¼Œæ¶‰åŠåˆ°äºŒç»´ç çš„æ‰«æåŠŸèƒ½ï¼ŒiOS7ä¹‹å‰ï¼Œå¼€å‘è€…è¿›è¡Œæ‰«ç ç¼–ç¨‹æ—¶ï¼Œä¸€èˆ¬ä¼šå€ŸåŠ©ç¬¬ä¸‰æ–¹åº“ã€‚å¸¸ç”¨çš„æ˜¯ZBarSDKaå’ŒZXingObjCï¼ŒiOS7ä¹‹åï¼Œç³»ç»Ÿçš„AVMetadataObjectç±»ä¸­ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†è§£æäºŒç»´ç çš„æ¥å£ã€‚ç»è¿‡æµ‹è¯•ï¼Œä½¿ç”¨åŸç”ŸAPIæ‰«æå’Œå¤„ç†çš„æ•ˆç‡éå¸¸é«˜ï¼Œè¿œè¿œé«˜äºç¬¬ä¸‰æ–¹åº“ã€‚æˆ‘æŸ¥äº†å¾ˆå¤šçš„èµ„æ–™ï¼Œç½‘ä¸Šå…³äºç”¨ç³»ç»ŸåŸç”Ÿç±»æ¥å®ç°äºŒç»´ç æ‰«æçš„èµ„æ–™è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œä½†éƒ½ä¸æ˜¯å¾ˆå…¨ã€‚æ‰€ä»¥æˆ‘æŠŠä¸€å¥—åŠŸèƒ½çš„å®ç°åˆ†äº«å‡ºæ¥ï¼Œå¸Œæœ›ä½ ä»¬å–œæ¬¢ã€‚</p>
<h3 id="è¿™é‡ŒåŒ…å«ï¼š"><a href="#è¿™é‡ŒåŒ…å«ï¼š" class="headerlink" title="è¿™é‡ŒåŒ…å«ï¼š"></a>è¿™é‡ŒåŒ…å«ï¼š</h3><ul>
<li>1ã€çª—å£çš„æ­å»º</li>
<li>2ã€äºŒç»´ç çš„æ‰«æ</li>
<li>3ã€ä»ç›¸å†Œä¸­è¯»å–äºŒç»´ç </li>
<li>4ã€ç”ŸæˆäºŒç»´ç </li>
<li>5ã€é•¿æŒ‰è¯†åˆ«äºŒç»´ç </li>
</ul>
<p>å…¶ä¸­äºŒç»´ç çš„æ‰«æä¸»è¦æ˜¯ç”¨åˆ°AVFoundationè¿™ä¸ªæ¡†æ¶ä¸­çš„AVCaptureSessionï¼Œè¯»å–äºŒç»´ç å’Œè¯†åˆ«äºŒç»´ç æ˜¯åŒä¸ªåŸç†ï¼Œåªæ˜¯å¤„ç†æ–¹å¼ä¸åŒï¼Œä¸»è¦ç”¨åˆ°çš„æ˜¯CIDetectorç±»ï¼Œè€Œç”ŸæˆäºŒç»´ç è¦ç”¨åˆ°CoreImageæ¡†æ¶ä¸­çš„CIFilteræ»¤é•œç±»ï¼Œå€¼å¾—ä¸€æçš„æ˜¯CoreImageéå¸¸å¼ºå¤§ï¼Œè¿™æ˜¯iOSä¸­å…³äºå›¾ç‰‡å¤„ç†çš„å‡ ä¹æ‰€æœ‰å†…å®¹é›†åˆï¼Œå³å›¾ç‰‡çš„å¤„ç†å‡ ä¹éƒ½åœ¨CoreImageä¸­ï¼ŒCIFilterä¹Ÿéå¸¸å€¼å¾—ä¸€ç©¶ï¼Œmacä¸Šåº”è¯¥åœ¨CoreQuartzä¸­ã€‚CoreImageå’ŒCIFilterçš„å†…å®¹å¾ˆå¤šï¼Œæˆ‘å¯èƒ½ä¼šåœ¨å¦å¤–çš„æ–‡ç« ä¸­å»åˆ†äº«ã€‚ï¼ˆæˆ‘å¹¶ä¸æ˜¯å¤§ç¥ï¼Œä¸æ•¢å¹ç‰›é€¼è¯´ç»™å¤§å®¶è®²è§£ï¼Œåªæ˜¯åˆ†äº«å’Œå¤§å®¶ç›¸äº’å­¦ä¹ ï¼‰</p>
<p>è¯¦æƒ…çœ‹çœ‹æˆ‘çš„æºç ï¼š<br><a href="https://github.com/JornWu/MeiTuan_Swift" target="_blank" rel="noopener">ç¾å›¢çš„é«˜ä»¿é¡¹ç›®</a> æ›´å¤šæ¨¡å—ä¸­çš„â€œæ‰«ä¸€æ‰«â€</p>
<hr>
<h2 id="1ã€çª—å£çš„æ­å»º"><a href="#1ã€çª—å£çš„æ­å»º" class="headerlink" title="1ã€çª—å£çš„æ­å»º"></a>1ã€çª—å£çš„æ­å»º</h2><p>è¿™æ˜¯UIçš„ä¸œè¥¿ï¼Œå¾ˆç®€å•ï¼Œæƒ³æ€ä¹ˆå¼„å°±æ€ä¹ˆå¼„ï¼Œåªè¦ä½ happyå°±okï¼Œè¿™æ˜¯æˆ‘çš„ä»£ç ï¼š</p>
<p>1.1ã€è®¾ç½®å¯¼èˆªæ¡ï¼šsetupNavView()ï¼ŒeditItemAction()ä¸­å› ä¸ºåœ¨iOS9+å¹³å°ï¼Œæ‰€ä»¥ç”¨UIAlertControlleræ¥åˆ—å‡ºå¤šä¸ªActionSheetåŠŸèƒ½</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">func setupNavView() &#123;</span><br><span class="line">	</span><br><span class="line">self.navigationController?.navigationBar.barTintColor = UIColor.clearColor()</span><br><span class="line">        self.title = &quot;äºŒç»´ç /æ¡å½¢ç &quot;</span><br><span class="line">        //è®¾ç½®æ ‡é¢˜é¢œè‰²</span><br><span class="line">        let navigationTitleAttribute = NSDictionary(object: UIColor.whiteColor(), forKey: NSForegroundColorAttributeName)</span><br><span class="line">        self.navigationController?.navigationBar.titleTextAttributes = navigationTitleAttribute as? [String : AnyObject]</span><br><span class="line">        </span><br><span class="line">        //1.è¿”å›</span><br><span class="line">        let backBtn = UIButton(type: UIButtonType.Custom)</span><br><span class="line">        backBtn.frame = CGRectMake(20, 30, 25, 25);</span><br><span class="line">        </span><br><span class="line">        backBtn.setBackgroundImage(UIImage(named: &quot;qrcode_scan_titlebar_back_nor&quot;), forState:UIControlState.Normal);</span><br><span class="line">        backBtn.contentMode = UIViewContentMode.ScaleAspectFit</span><br><span class="line">        backBtn.addTarget(self, action: #selector(QRCodeScanViewController.backBtnAction), forControlEvents: UIControlEvents.TouchUpInside)</span><br><span class="line">        </span><br><span class="line">        let backItem = UIBarButtonItem(customView: backBtn)</span><br><span class="line">        self.navigationItem.leftBarButtonItem = backItem</span><br><span class="line">        </span><br><span class="line">        let editItem = UIBarButtonItem(barButtonSystemItem: .Edit, target: self, action: #selector(QRCodeScanViewController.editItemAction))</span><br><span class="line">        self.navigationItem.rightBarButtonItem = editItem</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">       //  deprecated  //</span><br><span class="line">//        //2.ç›¸å†Œ</span><br><span class="line">//        let albumBtn = UIButton(type: UIButtonType.Custom)</span><br><span class="line">//        albumBtn.frame = CGRectMake(0, 0, 35, 49)</span><br><span class="line">//        albumBtn.center = CGPointMake(self.view.bounds.width / 2, 20 + 49 / 2.0)</span><br><span class="line">//        albumBtn.setBackgroundImage(UIImage(named: &quot;qrcode_scan_btn_photo_down&quot;), forState: UIControlState.Normal)</span><br><span class="line">//        albumBtn.contentMode=UIViewContentMode.ScaleAspectFit</span><br><span class="line">//        albumBtn.addTarget(self, action: #selector(QRCodeScanViewController.openAlbum), forControlEvents: UIControlEvents.TouchUpInside)//        self.view.addSubview(albumBtn)</span><br><span class="line">//        </span><br><span class="line">//        //3.é—ªå…‰ç¯</span><br><span class="line">//        let flashBtn = UIButton(type: UIButtonType.Custom)</span><br><span class="line">//        flashBtn.frame = CGRectMake(self.view.bounds.width - 55, 20, 35, 49)</span><br><span class="line">//        flashBtn.setBackgroundImage(UIImage(named: &quot;qrcode_scan_btn_flash_down&quot;), forState: UIControlState.Normal)</span><br><span class="line">//        flashBtn.contentMode=UIViewContentMode.ScaleAspectFit</span><br><span class="line">//        flashBtn.addTarget(self, action: #selector(QRCodeScanViewController.openFlash(_:)), forControlEvents: UIControlEvents.TouchUpInside)</span><br><span class="line">//        self.view.addSubview(flashBtn)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">func editItemAction() &#123;</span><br><span class="line">        </span><br><span class="line">        let actionSheet = UIAlertController(title: nil, message: nil, preferredStyle: .ActionSheet)</span><br><span class="line">        let action1 = UIAlertAction(title: &quot;ä»ç›¸å†Œé€‰å–äºŒç»´ç &quot;, style: .Default) &#123;</span><br><span class="line">            [unowned self]</span><br><span class="line">            (act) in</span><br><span class="line">            self.openAlbum()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        let action2 = UIAlertAction(title: &quot;æ‰“å¼€é—ªå…‰ç¯&quot;, style: .Default) &#123;</span><br><span class="line">            [unowned self]</span><br><span class="line">            (act) in</span><br><span class="line">            self.openFlash()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        let action3 = UIAlertAction(title: &quot;ç”ŸæˆäºŒç»´ç &quot;, style: .Default) &#123;</span><br><span class="line">            [unowned self]</span><br><span class="line">            (act) in</span><br><span class="line">            </span><br><span class="line">            let inputVC = UIAlertController(title: &quot;è¾“å…¥ä¿¡æ¯&quot;, message: nil, preferredStyle: .Alert)</span><br><span class="line">            let cancelAction = UIAlertAction(title: &quot;å–æ¶ˆ&quot;, style: .Cancel, handler: nil)</span><br><span class="line">            let okayAction = UIAlertAction(title: &quot;ç¡®å®š&quot;, style: .Default)&#123;</span><br><span class="line">                [unowned self]</span><br><span class="line">                (act) in</span><br><span class="line">                ///ç”ŸæˆäºŒç»´ç å›¾ç‰‡</span><br><span class="line">                let QRCodeImage = self.createQRCodeImage(withImage: UIImage(named: &quot;icon_mine_default_portrait&quot;)!, string: self.textInfo!)</span><br><span class="line">                </span><br><span class="line">                ///å±•ç¤ºåœ¨ç•Œé¢ä¸Š</span><br><span class="line">                let imageBtn = UIButton(frame: CGRectMake(0, 64, SCREENWIDTH, SCREENHEIGHT - 64))</span><br><span class="line">                imageBtn.setImage(QRCodeImage, forState: .Normal)</span><br><span class="line">                imageBtn.addTarget(self, action: #selector(self.imageBtnAction(_:)), forControlEvents: .TouchUpInside)</span><br><span class="line">                imageBtn.backgroundColor = THEMECOLOR</span><br><span class="line">                self.view.addSubview(imageBtn)</span><br><span class="line">                </span><br><span class="line">                ///ä¿å­˜åˆ°ç›¸å†Œ</span><br><span class="line">                //UIImageWriteToSavedPhotosAlbum(QRCodeImage, self, #selector(self.image(_: didFinishSavingWithError: contextInfo: )), nil)</span><br><span class="line">                </span><br><span class="line">                inputVC.dismissViewControllerAnimated(true, completion: &#123; </span><br><span class="line">                    print(&quot;ç”ŸæˆäºŒç»´ç &quot;)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            inputVC.addAction(cancelAction)</span><br><span class="line">            inputVC.addAction(okayAction)</span><br><span class="line">            </span><br><span class="line">            inputVC.addTextFieldWithConfigurationHandler(&#123; (textField) in</span><br><span class="line">                textField.borderStyle = .None</span><br><span class="line">                textField.placeholder = &quot;è¾“å…¥éœ€è¦ä¿å­˜çš„ä¿¡æ¯&quot;</span><br><span class="line">                textField.delegate = self</span><br><span class="line">                textField.becomeFirstResponder()</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">            self.presentViewController(inputVC, animated: true, completion: &#123;</span><br><span class="line">                print(&quot;è¾“å…¥ä¿¡æ¯å¯ä»¥ç”ŸæˆäºŒç»´ç &quot;)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        let action4 = UIAlertAction(title: &quot;å–æ¶ˆ&quot;, style: .Cancel, handler: nil)</span><br><span class="line">        </span><br><span class="line">        actionSheet.addAction(action1)</span><br><span class="line">        actionSheet.addAction(action2)</span><br><span class="line">        actionSheet.addAction(action3)</span><br><span class="line">        actionSheet.addAction(action4)</span><br><span class="line">        </span><br><span class="line">        self.presentViewController(actionSheet, animated: true, completion: nil)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>1.3ã€é®ç½©ï¼ˆè’™æ¿ï¼‰çš„è®¾ç½®ï¼šsetupMaskView()</p>
<pre><code>
 let kMargin = CGFloat(50)


    func setupMaskView() {

        maskView = UIView()
        maskView.layer.borderColor = UIColor(red: CGFloat(0), green: CGFloat(0), blue: CGFloat(0), alpha: CGFloat(0.7)).CGColor
        maskView.layer.borderWidth = kMargin

        let maskViewSize = CGSizeMake(self.view.extWidth(), self.view.extWidth())///æ­£æ–¹å½¢ï¼Œä¸‹é¢ä¼šéœ²å‡ºæ¥ï¼Œè¿˜è¦æ·»åŠ è¡¥å……é®ç½©
        maskView.frame = CGRectMake(0, 64, maskViewSize.width, maskViewSize.height)
        self.view.addSubview(maskView)

        ///è¡¥å……é®ç½©
        let mask = UIView(frame: CGRectMake(0, maskView.extY() + maskView.extHeight(), SCREENWIDTH, SCREENHEIGHT - (maskView.extY() + maskView.extHeight())))
        mask.backgroundColor = UIColor(red: CGFloat(0), green: CGFloat(0), blue: CGFloat(0), alpha: CGFloat(0.7))
        self.view.addSubview(mask)

    }

</code></pre>

<p>1.4ã€æ‰«æåŒºåŸŸçš„è®¾ç½®ï¼šsetupScanWindowView()</p>
<pre><code>
 func setupScanWindowView() {

        let scanWindowH = maskView.extWidth() - kMargin * 2 ///kMarginä¸ºé»‘è‰²è¾¹æ¡†çš„ä¸€åŠï¼Œ
        let scanWindowW = scanWindowH

        scanWindow =  UIView(frame: CGRectMake(kMargin, kMargin + 64, scanWindowW, scanWindowH))///éšå½¢çš„æ¡†
        scanWindow.clipsToBounds = true
        self.view.addSubview(scanWindow)

        scanNetImageView = UIImageView(image: UIImage(named: "scan_net"))
        scanNetImageView.extSetY(-1 * scanNetImageView.extHeight())
        scanWindow.addSubview(scanNetImageView)

        let buttonWH = CGFloat(18)
        let topLift = UIImageView(frame: CGRectMake(0, 0, buttonWH, buttonWH))
        topLift.image = UIImage(named: "scan_1")
        let topRight = UIImageView(frame: CGRectMake(scanWindowW - buttonWH, 0, buttonWH, buttonWH))
        topRight.image = UIImage(named: "scan_2")
        let bottomLeft = UIImageView(frame: CGRectMake(0, scanWindowH - buttonWH, buttonWH, buttonWH))
        bottomLeft.image = UIImage(named: "scan_3")
        let bottomRight = UIImageView(frame: CGRectMake(topRight.frame.origin.x, bottomLeft.frame.origin.y, buttonWH, buttonWH))
        bottomRight.image = UIImage(named: "scan_4")

        scanWindow.addSubview(topLift)
        scanWindow.addSubview(topRight)
        scanWindow.addSubview(bottomLeft)
        scanWindow.addSubview(bottomRight)

        self.view.addSubview(scanWindow)
    }

</code></pre>

<h2 id="2ã€äºŒç»´ç çš„æ‰«æ"><a href="#2ã€äºŒç»´ç çš„æ‰«æ" class="headerlink" title="2ã€äºŒç»´ç çš„æ‰«æ"></a>2ã€äºŒç»´ç çš„æ‰«æ</h2><p>ä¸»è¦ç”¨çš„çš„æ˜¯AVCaptureSessionç±»ï¼Œç„¶åè®¾ç½®inputå’Œoutputå³å¯ï¼Œå€¼å¾—ä¸€æçš„æ˜¯æ‰«ç æ”¯æŒçš„ç±»å‹ï¼šoutput.metadataObjectTypesã€‚iOSå·²ç»æä¾›äº†å¾ˆå¤šï¼Œä½†æ˜¯å¹¶ä¸å…¨ï¼Œä¸è¿‡åŒ…å«äº†å¸¸ç”¨çš„äºŒç»´ç AVMetadataObjectTypeQRCodeå’Œæ¡å½¢ç AVMetadataObjectTypeCode128Codeç­‰</p>
<pre><code>
func beginScanning() {///è¦çœŸæœº
        ///æ¨¡æ‹Ÿå›¾ç‰‡åŠ¨èµ·æ¥
        ///way 1ã€UIView Animation
        UIView.animateWithDuration(1.5, delay: 0, options: UIViewAnimationOptions.Repeat, animations: {
            [unowned self] in
            self.scanNetImageView.transform = CGAffineTransformTranslate(self.scanNetImageView.transform, 0, self.scanWindow.extHeight())
            }, completion: nil)

        ///way 2ã€coreAnimation


        //åˆå§‹åŒ–é“¾æ¥å¯¹è±¡
        session = AVCaptureSession()
        //é«˜è´¨é‡é‡‡é›†ç‡
        session.sessionPreset = AVCaptureSessionPresetHigh

        let preLayer = AVCaptureVideoPreviewLayer(session: session)///æ³¨æ„sessionå­˜æ”¾çš„åœ°æ–¹
        preLayer.frame = self.view.bounds
        self.view.layer.insertSublayer(preLayer, atIndex: 0)

        /*
         * AVCaptureDevice è·å–æ‘„åƒè®¾å¤‡
         * AVCaptureDeviceInput åˆ›å»ºè¾“å…¥æµ
         * AVCaptureMetadataOutput åˆ›å»ºè¾“å‡ºäº†
         */

        let device = AVCaptureDevice.defaultDeviceWithMediaType(AVMediaTypeVideo)
        var input: AVCaptureDeviceInput?
        do {

            input = try AVCaptureDeviceInput(device: device)
            ///add input

        }catch let error as NSError {
            // å‘ç”Ÿäº†é”™è¯¯
            print(error.localizedDescription)
        }
        catch {
            print("--inputæœªçŸ¥é”™è¯¯--")
        }
        ///add input
        session.addInput(input)

        let output = AVCaptureMetadataOutput()
        ///add delegate
        output.setMetadataObjectsDelegate(self, queue: dispatch_get_main_queue())//ä¸»é˜Ÿåˆ—ï¼ˆä¸»çº¿ç¨‹ï¼‰

        ///è®¾ç½®â€œæ„Ÿå…´è¶£â€åŒºåŸŸï¼ˆæ•æ„ŸåŒºåŸŸï¼‰
        let interestRect = preLayer.metadataOutputRectOfInterestForRect(scanWindow.frame)///æ‰«æåŒº åˆ° metadataè¾“å‡ºåŒº
        ///å€¼ç­‰äºCGRectMake(scanWindow.extY() / SCREENHEIGHT, scanWindow.extX() / SCREENWIDTH, scanWindow.extHeight() / SCREENHEIGHT, scanWindow.extWidth() / SCREENWIDTH)
        ///æŠŠä¸€ä¸ªåœ¨ preview layer åæ ‡ç³»ä¸­çš„rect è½¬æ¢æˆä¸€ä¸ªåœ¨ metadata output åæ ‡ç³»ä¸­çš„rect

        output.rectOfInterest = interestRect ///æ³¨æ„ï¼Œè¿™ä¸ªå¹¶ä¸æ˜¯æ‰«æåŒºçš„åæ ‡å°ºå¯¸

        session.addOutput(output)

        //è®¾ç½®æ‰«ç æ”¯æŒçš„ç±»å‹
        output.metadataObjectTypes = [AVMetadataObjectTypeDataMatrixCode,
                                      AVMetadataObjectTypeAztecCode,
                                      AVMetadataObjectTypeQRCode,
                                      AVMetadataObjectTypePDF417Code, 
                                      AVMetadataObjectTypeEAN13Code,
                                      AVMetadataObjectTypeEAN8Code,
                                      AVMetadataObjectTypeCode128Code]

        ///å¸¸ç”¨çš„ç åˆ¶æœ‰ï¼šPDF417äºŒç»´æ¡ç ã€DatamatrixäºŒç»´æ¡ç ã€QR Codeã€Code 49ã€Code 16Kã€Code oneç­‰ï¼Œ
        ///é™¤äº†è¿™äº›å¸¸è§çš„äºŒç»´æ¡ç ä¹‹å¤–ï¼Œè¿˜æœ‰Vericodeæ¡ç ã€Maxicodeæ¡ç ã€CPæ¡ç ã€Codablock Fæ¡ç ã€ Ultracodeæ¡ç åŠAztecæ¡ç ã€‚



        ///start grab
        session.startRunning()

    }

</code></pre>

<h2 id="3ã€ä»ç›¸å†Œä¸­è¯»å–äºŒç»´ç "><a href="#3ã€ä»ç›¸å†Œä¸­è¯»å–äºŒç»´ç " class="headerlink" title="3ã€ä»ç›¸å†Œä¸­è¯»å–äºŒç»´ç "></a>3ã€ä»ç›¸å†Œä¸­è¯»å–äºŒç»´ç </h2><p>ä¸»è¦ç”¨åˆ°çš„æ˜¯CIDetectoræ£€æµ‹å™¨ç±»ï¼Œç„¶åè·å–featureå¯¹è±¡ã€‚</p>
<pre><code>

/***********ç…§ç‰‡è¯»å–**************/

    func openAlbum(){//ç›¸å†Œ

        if(UIImagePickerController.isSourceTypeAvailable(UIImagePickerControllerSourceType.PhotoLibrary)){

            ///1.åˆå§‹åŒ–ç›¸å†Œæ‹¾å–å™¨
            let pikController = UIImagePickerController()
            ///2.è®¾ç½®ä»£ç†
            pikController.delegate = self//ä¸¤ä¸ªä»£ç†
            //3.è®¾ç½®èµ„æºï¼š
            /**
            UIImagePickerControllerSourceTypePhotoLibrary,ç›¸å†Œ
            UIImagePickerControllerSourceTypeCamera,ç›¸æœº
            UIImagePickerControllerSourceTypeSavedPhotosAlbum,ç…§ç‰‡åº“
            */
            pikController.sourceType = UIImagePickerControllerSourceType.SavedPhotosAlbum
            //4.éšä¾¿ç»™ä»–ä¸€ä¸ªè½¬åœºåŠ¨ç”»
            pikController.modalTransitionStyle = UIModalTransitionStyle.FlipHorizontal
            self.presentViewController(pikController, animated: true, completion: nil)

        }else{

            let alertVC = UIAlertController(title: "æç¤º", message: "è®¾å¤‡ä¸æ”¯æŒè®¿é—®ç›¸å†Œï¼Œè¯·åœ¨è®¾ç½®->éšç§->ç…§ç‰‡ä¸­è¿›è¡Œè®¾ç½®ï¼", preferredStyle: UIAlertControllerStyle.Alert)
            let action = UIAlertAction(title: "OK", style: .Cancel, handler: nil)
            alertVC.addAction(action)

            self.presentViewController(alertVC, animated: true, completion: nil)

        }

    }

    ///imagePickerControllerdelegate func
    func imagePickerController(picker: UIImagePickerController, didFinishPickingMediaWithInfo info: [String : AnyObject]) {
        ///1.è·å–é€‰æ‹©çš„å›¾ç‰‡
        let image = info[UIImagePickerControllerOriginalImage]
        ///2.åˆå§‹åŒ–ä¸€ä¸ªç›‘æµ‹å™¨
        let detector = CIDetector(ofType: CIDetectorTypeQRCode, context: nil, options: [ CIDetectorAccuracy : CIDetectorAccuracyHigh ])
        picker.dismissViewControllerAnimated(true) { () -> Void in
            ///ç›‘æµ‹åˆ°çš„ç»“æœæ•°ç»„
            let features = detector.featuresInImage(CIImage(CGImage: (image?.CGImage)!))

            if features.count >= 1 {
                /**ç»“æœå¯¹è±¡ */
                ///CIQRCodeFeature
                let feature = features[0] as! CIQRCodeFeature
                let scannedResult = feature.messageString

                let alertVC = UIAlertController(title: "æç¤º", message: scannedResult, preferredStyle: UIAlertControllerStyle.Alert)
                self.presentViewController(alertVC, animated: true, completion: nil)

            }else {
                let alertVC = UIAlertController(title: "æç¤º", message: "è¯¥å›¾ç‰‡æ²¡æœ‰åŒ…å«ä¸€ä¸ªäºŒç»´ç ï¼", preferredStyle: UIAlertControllerStyle.Alert)
                let action = UIAlertAction(title: "OK", style: .Cancel, handler: nil)
                alertVC.addAction(action)

                self.presentViewController(alertVC, animated: true, completion: nil)
            }
        }
    }

</code></pre>

<h2 id="4ã€ç”ŸæˆäºŒç»´ç "><a href="#4ã€ç”ŸæˆäºŒç»´ç " class="headerlink" title="4ã€ç”ŸæˆäºŒç»´ç "></a>4ã€ç”ŸæˆäºŒç»´ç </h2><p>ç”ŸæˆäºŒç»´ç å¤„ç†è¿‡ç¨‹æœ‰ç‚¹å¤æ‚ï¼Œé¦–å…ˆè¦å¯¼å…¥CoreImageï¼Œç„¶åç”¨CIFilterç”Ÿæˆå›¾ç‰‡ï¼Œnameä¸ºCIQRCodeGeneratorå°±æ˜¯äºŒç»´ç æ»¤é•œï¼ŒCICode128BarcodeGeneratorå°±æ˜¯æ¡å½¢ç æ»¤é•œï¼Œå½“ç„¶è¿˜æœ‰å¾ˆå¤šæ»¤é•œï¼Œå¦‚ä¸‹é¢ä¼šç”¨åˆ°çš„é¢œè‰²æ»¤é•œnameä¸ºCIFalseColorã€‚</p>
<p>4.1ã€åŸç”ŸäºŒç»´ç çš„ç”Ÿæˆ</p>
<pre><code>
 /***********ç”ŸæˆäºŒç»´ç å›¾ç‰‡**************/ ///coreImage

    func createQRCodeImage(withImage image: UIImage, string: String) -> UIImage {

        /// 1. å®ä¾‹åŒ–äºŒç»´ç æ»¤é•œ
        let filter = CIFilter(name: "CIQRCodeGenerator")///CICode128BarcodeGenerator ///æ¡å½¢ç 
        ///æ³¨æ„

        /// 2. æ¢å¤æ»¤é•œçš„é»˜è®¤å±æ€§
        filter?.setDefaults()

        /// 3. å°†å­—ç¬¦ä¸²è½¬æ¢æˆäºŒè¿›åˆ¶æ•°æ®ï¼Œï¼ˆç”ŸæˆäºŒç»´ç æ‰€éœ€çš„æ•°æ®ï¼‰
        let data = string.dataUsingEncoding(NSUTF8StringEncoding)

        /// 4. é€šè¿‡KVOæŠŠäºŒè¿›åˆ¶æ•°æ®æ·»åŠ åˆ°æ»¤é•œinputMessageä¸­
        filter?.setValue(data, forKey: "inputMessage")
        filter?.setValue("H", forKey: "inputCorrectionLevel")

        /// 5. è·å¾—æ»¤é•œè¾“å‡ºçš„å›¾åƒ
        let outputImage = filter?.outputImage ///CIImage

        /// 6. å°†CIImageè½¬æ¢æˆUIImageï¼Œå¹¶æ”¾å¤§æ˜¾ç¤º
        //let originQRCodeImage = UIImage(CIImage: outputImage!, scale: 0.07, orientation: UIImageOrientation.Up) ///åŸç”ŸäºŒç»´ç å›¾ç‰‡ ///è¿™æ ·å°†å›¾ç‰‡æ”¾å¤§ä¼šå˜å¾—æ¨¡ç³Š
        //return originQRCodeImage

        ///è¿›è¡Œé‡ç»˜
        let newQRCodeImage = createUIimageWithCGImage(ciImage: outputImage!, widthAndHeightValue: 300)

        return newQRCodeImage
    }

</code></pre>

<p>å¦‚æœä½ ç›´æ¥ç”¨è¿™è¡Œä»£ç è¿”å›å›¾ç‰‡</p>
<pre><code>
let originQRCodeImage = UIImage(CIImage: outputImage!, scale: 0.07, orientation: UIImageOrientation.Up) ///åŸç”ŸäºŒç»´ç å›¾ç‰‡ ///è¿™æ ·å°†å›¾ç‰‡æ”¾å¤§ä¼šå˜å¾—æ¨¡ç³Š
return originQRCodeImage
</code></pre> 

<p> å¾—åˆ°çš„å›¾ç‰‡å°†ä¼šå¾ˆæ¨¡ç³Šï¼Œå› ä¸ºè¿™æ˜¯å°†å›¾ç‰‡è¿›è¡Œæ”¾å¤§äº†ï¼Œä½†å›¾ç‰‡å°†0.07æ”¹ä¸ºäº†1ï¼Œçœ‹åˆ°çš„å›¾ç‰‡å°†ä¼šå¾ˆå°ã€‚ </p>
<p> æ‰€ä»¥è¿˜çš„å¤„ç†ä¸€ä¸‹ï¼š</p>
<pre><code>     
func createUIimageWithCGImage(ciImage image: CIImage, widthAndHeightValue wh: CGFloat) -> UIImage {
        let ciRect = CGRectIntegral(image.extent)///æ ¹æ®å®¹å™¨å¾—åˆ°é€‚åˆçš„å°ºå¯¸
        let scale = min(wh / ciRect.width, wh / ciRect.height)

        ///è·å–bitmap

        let width  = size_t(ciRect.width * scale)
        let height  = size_t(ciRect.height * scale)
        let cs = CGColorSpaceCreateDeviceGray()///ç°åº¦é¢œè‰²é€šé“ ///CGColorSpaceRef

        let info_UInt32 = CGImageAlphaInfo.None.rawValue
        let bitmapRef = CGBitmapContextCreate(nil, width, height, 8, 0, cs, info_UInt32)

        let contex = CIContext(options: nil)
        let bitmapImageRef = contex.createCGImage(image, fromRect: CGRectMake(ciRect.origin.x, ciRect.origin.y, ciRect.size.width, ciRect.size.height)) ///CGImageRef

        CGContextSetInterpolationQuality(bitmapRef, CGInterpolationQuality.High)///å†™å…¥è´¨é‡é«˜ï¼Œæ—¶é—´é•¿
        CGContextScaleCTM(bitmapRef, scale, scale) ///è°ƒæ•´â€œç”»å¸ƒâ€çš„ç¼©æ”¾
        CGContextDrawImage(bitmapRef, ciRect, bitmapImageRef) ///ç»˜åˆ¶å›¾ç‰‡

        ///ä¿å­˜
        let scaledImage = CGBitmapContextCreateImage(bitmapRef)

        ///bitmapRefå’ŒbitmapImageRefä¸ç”¨ä¸»åŠ¨é‡Šæ”¾ï¼ŒCore Foundationè‡ªåŠ¨ç®¡ç†

        //let originImage = UIImage(CGImage: scaledImage!) ///åŸç”Ÿç°åº¦å›¾ç‰‡ï¼ˆç°è‰²ï¼‰

        let ciImage = CIImage(CGImage: scaledImage!)

        ///æ·»åŠ æ»¤é•œ
        let colorFilter = CIFilter(name: "CIFalseColor")///é¢œè‰²æ»¤é•œ
        colorFilter!.setDefaults()
        colorFilter!.setValue(ciImage, forKey:kCIInputImageKey)

        colorFilter!.setValue(CIColor(red: 33.0 / 225.0, green: 192.0 / 225.0, blue: 174.0 / 225.0, alpha: 1.0), forKey:"inputColor0")///äºŒç»´ç å…ƒç´ ï¼ˆåƒç´ ï¼‰
        colorFilter!.setValue(CIColor(red: 1.0, green: 1.0, blue: 1.0, alpha: 1), forKey:"inputColor1")///èƒŒæ™¯

        let colorImgae = colorFilter!.outputImage
        let newQRCodeImage = UIImage(CIImage: colorImgae!)

        return newQRCodeImage

    }

</code></pre> 

<p>è¿™æ ·å°†ä¼šå¾—åˆ°å½©è‰²çš„äºŒç»´ç ï¼Œæ•ˆæœä¹Ÿè¿˜ä¸é”™ï¼Œè¿™é‡Œåˆæ·»åŠ colorFilterè¿™æ ·æ»¤é•œï¼Œè¾¾åˆ°ç€è‰²çš„æ•ˆæœã€‚iOSå…¶å®å¯ä»¥æ··åˆå¤šä¸ªæ»¤é•œæ¥å®ç°å¾ˆå¤šä¸èƒ½çš„æ•ˆæœï¼Œæ‰‹æœºè‡ªå¸¦çš„å›¾ç‰‡å¤„ç†å°±æ˜¯åŸºäºæ»¤é•œæ¥å®Œæˆï¼Œå¦‚æœä½ æœ‰ä½¿ç”¨è¿‡PSï¼Œæˆ–äº†è§£è¿‡çŸ¥è¯†ï¼Œè¿™å°±å¾ˆå®¹æ˜“ç†è§£äº†ã€‚å¦‚æœå»æ‰è¿™éƒ¨åˆ†ä»£ç å¾—åˆ°çš„å°†ä¼šæ˜¯ç°è‰²çš„å›¾ç‰‡ã€‚</p>
<p>å…¶å®é‡æ–°ç€è‰²ï¼Œè¿˜å¯ä»¥é€šè¿‡ï¼Œcontextæ¥é‡ç»˜æˆ–è€…é€šè¿‡æ”¹å˜æ¯ä¸ªåƒç´ çš„çš„é¢œè‰²å€¼æ¥è¾¾åˆ°ç›®çš„ï¼Œä½†æ˜¯éš¾åº¦ä¼šè¿œæ¯”æ·»åŠ ä¸€ä¸ªæ»¤é•œè¦å¤æ‚çš„å¤šï¼Œè€Œä¸”ï¼ŒSwiftä¸­é€šè¿‡æŒ‡é’ˆæ¥å¤„ç†æ•°æ®ï¼Œå†™æ³•å°†ä¼šæ›´åŠ å¤æ‚ï¼Œè¿™æ˜¯å› ä¸ºSwiftæ˜¯ä¸€é—¨è¯­æ³•å®‰å…¨æ€§è¯­è¨€ã€‚ä¹Ÿæ²¡æœ‰*Pè¿™æ ·çš„å†™æ³•ã€‚</p>
<p>å…³äºCIFilterçš„æ›´å¤šçŸ¥è¯†ï¼Œæˆ‘å°±ä¼šåœ¨åç»­æ–‡ç« ä¸­åˆ†äº«ï¼Œä½ ä»¬ä¹Ÿå¯ä»¥é€šè¿‡èµ„æ–™å»å­¦ä¹ ï¼Œæ€»ä¹‹ï¼Œè¿™éƒ¨åˆ†çŸ¥è¯†è¿˜æ˜¯å¾ˆå®¹æ˜“ç†è§£çš„ï¼Œä¹Ÿæ¯”è¾ƒæœ‰è¶£ã€‚</p>
<p>æœ€åï¼Œæƒ³äº†è§£æ›´å¤šè¯¦æƒ…ï¼šè¯·æŸ¥çœ‹æˆ‘çš„demoï¼Œè®°å¾—ç»™ä¸ªStarï¼ŒğŸ˜ğŸ˜ğŸ˜</p>
<p>ä¸‹è½½ï¼š<a href="https://github.com/JornWu/MeiTuan_Swift" target="_blank" rel="noopener">ç‚¹å‡»è¿™é‡Œ</a></p>

      
    </div>
    
    
    
		
		
		
		<div>
				<div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------æœ¬æ–‡ç»“æŸ<i class="fa fa-paw"></i>æ„Ÿè°¢æ‚¨çš„é˜…è¯»-------------</div>
    
</div>
		</div>
		

		
		<div>
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JSåº“ sweetalert å¯ä¿®æ”¹è·¯å¾„ -->
  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>æœ¬æ–‡æ ‡é¢˜:</span><a href="/blog/2016/09/17/iOS_æœ€å…¨çš„äºŒç»´ç ç¯‡/">iOS_æœ€å…¨çš„äºŒç»´ç ç¯‡</a></p>
  <p><span>æ–‡ç« ä½œè€…:</span><a href="/" title="è®¿é—® Jorn Wu çš„ä¸ªäººåšå®¢">Jorn Wu</a></p>
  <p><span>å‘å¸ƒæ—¶é—´:</span>2016å¹´09æœˆ17æ—¥ - 19:09</p>
  <p><span>æœ€åæ›´æ–°:</span>2019å¹´03æœˆ05æ—¥ - 23:03</p>
  <p><span>åŸå§‹é“¾æ¥:</span><a href="/blog/2016/09/17/iOS_æœ€å…¨çš„äºŒç»´ç ç¯‡/" title="iOS_æœ€å…¨çš„äºŒç»´ç ç¯‡">https://JornWu.github.io/blog/2016/09/17/iOS_æœ€å…¨çš„äºŒç»´ç ç¯‡/</a>
    <span class="copy-path" title="ç‚¹å‡»å¤åˆ¶æ–‡ç« é“¾æ¥"><i class="fa fa-clipboard" data-clipboard-text="https://JornWu.github.io/blog/2016/09/17/iOS_æœ€å…¨çš„äºŒç»´ç ç¯‡/" aria-label="å¤åˆ¶æˆåŠŸï¼"></i></span>
  </p>
  <p><span>è®¸å¯åè®®:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…</a> è½¬è½½è¯·ä¿ç•™åŸæ–‡é“¾æ¥åŠä½œè€…ã€‚</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
	  $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({   
          title: "",   
          text: 'å¤åˆ¶æˆåŠŸ',
          icon: "success", 
          showConfirmButton: true
          });
	    });
    });  
</script>

		</div>
		

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>åšæŒåŸåˆ›æŠ€æœ¯åˆ†äº«ï¼Œæ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œï¼</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>æ‰“èµ</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.png" alt="Jorn Wu å¾®ä¿¡æ”¯ä»˜">
        <p>å¾®ä¿¡æ”¯ä»˜</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.png" alt="Jorn Wu æ”¯ä»˜å®">
        <p>æ”¯ä»˜å®</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/blog/2016/09/21/CIFilterä»‹ç»/" rel="prev" title="çœ‹äº†è¿™ä¸ªï¼Œä½ å°±å¯ä»¥æ‰“é€ è‡ªå·±çš„ç¾å›¾ç§€ç§€">
                çœ‹äº†è¿™ä¸ªï¼Œä½ å°±å¯ä»¥æ‰“é€ è‡ªå·±çš„ç¾å›¾ç§€ç§€ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/blog/images/avatar.png" alt="Jorn Wu">
            
              <p class="site-author-name" itemprop="name">Jorn Wu</p>
              <p class="site-description motion-element" itemprop="description">Jorn çš„ä¸ªäººåšå®¢åˆ†äº«ç«™ï¼Œæ¶‰åŠiOSï¼ŒAndroidï¼ŒQtï¼ŒLinuxç­‰</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/blog/archives/">
              
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/JornWu" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:yourname@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.jianshu.com/u/c718dbf8e4d0" target="_blank" title="ç®€ä¹¦">
                      
                        <i class="fa fa-fw fa-globe"></i>ç®€ä¹¦</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#è¿™é‡ŒåŒ…å«ï¼š"><span class="nav-number">1.</span> <span class="nav-text">è¿™é‡ŒåŒ…å«ï¼š</span></a></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#1ã€çª—å£çš„æ­å»º"><span class="nav-number"></span> <span class="nav-text">1ã€çª—å£çš„æ­å»º</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2ã€äºŒç»´ç çš„æ‰«æ"><span class="nav-number"></span> <span class="nav-text">2ã€äºŒç»´ç çš„æ‰«æ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3ã€ä»ç›¸å†Œä¸­è¯»å–äºŒç»´ç "><span class="nav-number"></span> <span class="nav-text">3ã€ä»ç›¸å†Œä¸­è¯»å–äºŒç»´ç </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4ã€ç”ŸæˆäºŒç»´ç "><span class="nav-number"></span> <span class="nav-text">4ã€ç”ŸæˆäºŒç»´ç </span></a></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jorn Wu</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">10.7k</span>
  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user">æœ¬ç«™è®¿å®¢æ•°</i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      äººæ¬¡
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye">æœ¬ç«™æ€»è®¿é—®é‡</i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      æ¬¡
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  



  
  









  
  
    <script type="text/javascript" src="/blog/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/canvas-nest/canvas-nest.min.js"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/three/three-waves.min.js"></script>
  


  


  <script type="text/javascript" src="/blog/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/blog/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/blog/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/blog/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/blog/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/blog/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/blog/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
